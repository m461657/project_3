# Project 3
## Megan Willis & Kyle Goulart

```{r, eval = FALSE, echo = FALSE, warning = FALSE}
library(tidyverse)
library(tidymodels)
library(ggplot2)
library(ggthemes)
library(lubridate)
library(rpart.plot)
library(randomForest)
```


```{r, echo = FALSE, warning = FALSE}
# Our dataset: Spotify Songs
spotify_songs <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-01-21/spotify_songs.csv')
```

Our Artists:
Tame Impala
A$AP Rocky
Fleetwood Mac
Queen
Childish Gambino
Creedence Clearwater Revival
Elton John
Tyler, The Creator
Michael Jackson
Post Malone
Logic
Vampire Weekend
Chance
Mac DeMarco

## Data Wrangling

### Filtering for our favorite artists
```{r}
favorite_artists = spotify_songs %>% 
  filter(track_artist %in% c("Tame Impala", "A$AP Rocky", "Fleetwood Mac", "Queen", "Childish Gambino", "Creedence Clearwater Revival", "Elton John", "Tyler, The Creator", "Michael Jackson", "Post Malone", "Logic", "Vampire Weekend", "Chance the Rapper", "Mac DeMarco")) %>% 
  select(track_artist, track_name, track_album_name, track_album_release_date, track_popularity, playlist_genre, danceability, energy, loudness, speechiness, acousticness, instrumentalness, liveness, tempo, duration_ms)
```

### Let's create a column for release year
```{r}
favorite_artists = favorite_artists %>% 
  mutate(release_year = substring(track_album_release_date, 1, 4)) %>% 
  mutate(release_year = as.numeric(release_year)) %>% 
  select(track_artist, track_name, track_album_name, release_year, track_popularity, playlist_genre, danceability, energy, loudness, speechiness, acousticness, instrumentalness, liveness, tempo, duration_ms)
```


## Data Exploration

```{r}
rgb(30, 215, 96, max=255)

favorite_artists %>% 
  group_by(track_artist) %>% 
  count() %>% 
  ggplot(aes(x = fct_reorder(track_artist, n), y = n))+
  geom_col(aes(fill = "#1ED760"))+
  coord_flip()+
  labs(x = "", y = "Song Count")
```

```{r}
favorite_artists %>% 
  group_by(playlist_genre) %>% 
  count()
```

**Talk about how the predictions may be more accurate for those with more songs**

**If predictive model is REALLY bad create a fct_lump other category for artists with small n**

**predicting genre by popularity?**

**release date and popularity**

**Let's calculate the mean track_popularity for each artist**

```{r}
favorite_artists %>% 
  group_by(track_artist) %>% 
  summarize(mean_popularity = mean(track_popularity)) %>% 
  ggplot(aes(x = fct_reorder(track_artist, mean_popularity), y = mean_popularity))+
  geom_col()+
  coord_flip()
```

**Is there a relationship between release year and popularity?**

```{r}
ggplot(data = favorite_artists, aes(x = release_year, y = track_popularity))+
  geom_point(aes(color = track_artist))
```

```{r}
favorite_artists %>% 
  group_by(track_artist) %>% 
  summarize(mean_danceability = mean(danceability)) %>% 
  ggplot(aes(x = fct_reorder(track_artist, mean_danceability), y = mean_danceability))+
  geom_col()+
  coord_flip()
```

```{r}
favorite_artists %>% 
  group_by(track_artist) %>% 
  summarize(mean_tempo = mean(tempo)) %>% 
  ggplot(aes(x = fct_reorder(track_artist, mean_tempo), y = mean_tempo))+
  geom_col()+
  coord_flip()
```

```{r}
favorite_artists %>% 
  group_by(track_artist) %>% 
  summarize(mean_instrumentalness = mean(instrumentalness)) %>% 
  ggplot(aes(x = fct_reorder(track_artist, mean_instrumentalness), y = mean_instrumentalness))+
  geom_col()+
  coord_flip()
```


```{r}
favorite_artists %>% 
  group_by(track_artist) %>% 
  summarize(mean_acousticness = mean(acousticness)) %>% 
  ggplot(aes(x = fct_reorder(track_artist, mean_acousticness), y = mean_acousticness))+
  geom_col()+
  coord_flip()
```


## Predictive Model

```{r}
# create a dataset with the columns we are going to use to fit our model

artists_model = favorite_artists %>% 
  select(track_artist, track_popularity, playlist_genre, danceability, energy, loudness, speechiness, acousticness, instrumentalness, liveness, tempo, release_year)

# convert track_artist to a factor
artists_model$track_artist = as.factor(artists_model$track_artist)
```

```{r}
# Split the data into a testing and training set
set.seed(9)
artists_split = initial_split(artists_model, prop = .3)
artists_train = training(artists_split)
artists_test = testing(artists_split)
```
*Classification Tree*
```{r}
# fit a classification tree on the training set
artists_tree = decision_tree() %>% 
  set_engine(engine = "rpart") %>% 
  set_mode(mode = "classification") %>% 
  fit(track_artist ~ ., data = artists_train)

rpart.plot(artists_tree$fit, roundint = FALSE)
```

```{r}
# generate predictions using the trained model to predict track_artist for the testing set
tree_pred = artists_tree %>% 
  predict(new_data = artists_test)

# create a new column called pred_track_artist --> this gives the predicted track_artist based on our model
# calculate the accuracy of the model
artists_test %>% 
  mutate(pred_track_artist = tree_pred$.pred_class) %>% 
  accuracy(estimate = pred_track_artist, truth = track_artist)

artists_test %>% 
  mutate(pred_track_artist = tree_pred$.pred_class) %>% 
  select(track_artist, pred_track_artist)
```

```{r}
# now, check for overfitting
train_pred = artists_tree %>% 
  predict(new_data = artists_train)

artists_train %>% 
  mutate(pred_track_artist = train_pred$.pred_class) %>% 
  accuracy(estimate = pred_track_artist, truth = track_artist)
```
